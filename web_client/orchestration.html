<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé≠ Orchestration - TuniLink Smart City</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1em;
        }
        
        .scenarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .scenario-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .scenario-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .scenario-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .scenario-icon {
            font-size: 2.5em;
            margin-right: 15px;
        }
        
        .scenario-title {
            font-size: 1.3em;
            color: #333;
            font-weight: bold;
        }
        
        .scenario-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .scenario-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }
        
        .scenario-btn:hover {
            opacity: 0.9;
        }
        
        .scenario-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .results-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
        }
        
        .results-panel.active {
            display: block;
        }
        
        .results-title {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .result-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .result-section h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 5px 5px 5px 0;
        }
        
        .status-ok { background: #d4edda; color: #155724; }
        .status-warning { background: #fff3cd; color: #856404; }
        .status-error { background: #f8d7da; color: #721c24; }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }
        
        .metric-label {
            font-weight: bold;
            color: #666;
        }
        
        .metric-value {
            color: #333;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-size: 1.2em;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .back-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: white;
            color: #667eea;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            transition: transform 0.3s ease;
        }
        
        .back-link:hover {
            transform: scale(1.05);
        }
        
        .alert-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .transport-list {
            list-style: none;
            padding: 0;
        }
        
        .transport-item {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé≠ Sc√©narios d'Orchestration</h1>
            <p class="subtitle">D√©monstration des capacit√©s d'int√©gration multi-services</p>
        </header>

        <div class="scenarios-grid">
            <!-- Sc√©nario 1: City Dashboard -->
            <div class="scenario-card">
                <div class="scenario-header">
                    <span class="scenario-icon">üèôÔ∏è</span>
                    <span class="scenario-title">City Dashboard</span>
                </div>
                <p class="scenario-description">
                    Vue d'ensemble temps r√©el de tous les services de la ville. Combine Transport + Air + Tourisme + Urgences.
                </p>
                <button class="scenario-btn" onclick="runScenario('city-dashboard')">
                    Afficher le Tableau de Bord
                </button>
            </div>

            <!-- Sc√©nario 2: Plan Trip -->
            <div class="scenario-card">
                <div class="scenario-header">
                    <span class="scenario-icon">üó∫Ô∏è</span>
                    <span class="scenario-title">Plan Trip</span>
                </div>
                <p class="scenario-description">
                    Planification intelligente de trajet selon la qualit√© de l'air. Combine SOAP + REST avec filtrage g√©ographique.
                </p>
                <select id="tripZone" style="width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="Tunis Centre-Ville">üèõÔ∏è Tunis Centre-Ville</option>
                    <option value="La Marsa">üèñÔ∏è La Marsa</option>
                    <option value="Carthage">üèõÔ∏è Carthage</option>
                    <option value="Ariana">üå≥ Ariana</option>
                    <option value="Bardo">üé® Bardo</option>
                </select>
                <button class="scenario-btn" onclick="runScenario('plan-trip')">
                    Planifier mon Trajet
                </button>
            </div>

            <!-- Sc√©nario 3: Emergency Response -->
            <div class="scenario-card">
                <div class="scenario-header">
                    <span class="scenario-icon">üö®</span>
                    <span class="scenario-title">Emergency Response</span>
                </div>
                <p class="scenario-description">
                    Coordination d'urgence avec dispatch gRPC, gestion du trafic REST et analyse SOAP de l'air.
                </p>
                <select id="emergencyZone" style="width: 100%; padding: 8px; margin-bottom: 5px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="Carthage">Carthage</option>
                    <option value="La Marsa">La Marsa</option>
                    <option value="Tunis Centre-Ville">Tunis Centre-Ville</option>
                </select>
                <select id="emergencyType" style="width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="medical">üöë Urgence M√©dicale</option>
                    <option value="fire">üöí Incendie</option>
                    <option value="crime">üöì Crime/S√©curit√©</option>
                </select>
                <button class="scenario-btn" onclick="runScenario('emergency-response')">
                    D√©clencher Intervention
                </button>
            </div>

            <!-- Sc√©nario 4: Tourist Day -->
            <div class="scenario-card">
                <div class="scenario-header">
                    <span class="scenario-icon">üéí</span>
                    <span class="scenario-title">Tourist Day</span>
                </div>
                <p class="scenario-description">
                    Planification journ√©e touristique selon m√©t√©o. GraphQL attractions + SOAP air + REST transports.
                </p>
                <button class="scenario-btn" onclick="runScenario('tourist-day')">
                    Planifier ma Journ√©e
                </button>
            </div>

            <!-- Sc√©nario 5: Eco Route -->
            <div class="scenario-card">
                <div class="scenario-header">
                    <span class="scenario-icon">üå±</span>
                    <span class="scenario-title">Eco Route</span>
                </div>
                <p class="scenario-description">
                    Trajet √©cologique optimis√© √©vitant les zones pollu√©es. Analyse multi-zones SOAP.
                </p>
                <select id="startZone" style="width: 100%; padding: 8px; margin-bottom: 5px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="Ariana">Ariana</option>
                    <option value="Bardo">Bardo</option>
                    <option value="Tunis Centre-Ville">Tunis Centre-Ville</option>
                </select>
                <select id="endZone" style="width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="La Marsa">La Marsa</option>
                    <option value="Carthage">Carthage</option>
                    <option value="La Goulette">La Goulette</option>
                </select>
                <button class="scenario-btn" onclick="runScenario('eco-route')">
                    Calculer Trajet √âco
                </button>
            </div>
        </div>

        <!-- Panneau de r√©sultats -->
        <div class="results-panel" id="resultsPanel">
            <h2 class="results-title" id="resultsTitle">R√©sultats</h2>
            <div id="resultsContent"></div>
        </div>

        <a href="index.html" class="back-link">‚¨ÖÔ∏è Retour au Dashboard Principal</a>
    </div>

    <script>
        const API_URL = 'http://localhost:8888';

        async function runScenario(scenario) {
            const resultsPanel = document.getElementById('resultsPanel');
            const resultsTitle = document.getElementById('resultsTitle');
            const resultsContent = document.getElementById('resultsContent');

            // Afficher le panneau avec loading
            resultsPanel.classList.add('active');
            resultsContent.innerHTML = '<div class="loading"><div class="spinner"></div>Chargement des donn√©es...</div>';

            // Scroll vers les r√©sultats
            resultsPanel.scrollIntoView({ behavior: 'smooth' });

            try {
                let url = '';
                let data = null;

                switch(scenario) {
                    case 'city-dashboard':
                        url = `${API_URL}/api/orchestration/city-dashboard`;
                        resultsTitle.textContent = 'üèôÔ∏è Tableau de Bord Ville';
                        break;

                    case 'plan-trip':
                        const zone = document.getElementById('tripZone').value;
                        url = `${API_URL}/api/orchestration/plan-trip?zone=${encodeURIComponent(zone)}`;
                        resultsTitle.textContent = `üó∫Ô∏è Planification Trajet - ${zone}`;
                        break;

                    case 'emergency-response':
                        const emergencyZone = document.getElementById('emergencyZone').value;
                        const emergencyType = document.getElementById('emergencyType').value;
                        url = `${API_URL}/api/orchestration/emergency-response?zone=${encodeURIComponent(emergencyZone)}&emergency_type=${emergencyType}`;
                        resultsTitle.textContent = `üö® R√©ponse d'Urgence - ${emergencyZone}`;
                        break;

                    case 'tourist-day':
                        url = `${API_URL}/api/orchestration/tourist-day?zone=Centre-Ville`;
                        resultsTitle.textContent = 'üéí Journ√©e Touristique';
                        break;

                    case 'eco-route':
                        const start = document.getElementById('startZone').value;
                        const end = document.getElementById('endZone').value;
                        url = `${API_URL}/api/orchestration/eco-route?start_zone=${encodeURIComponent(start)}&end_zone=${encodeURIComponent(end)}`;
                        resultsTitle.textContent = `üå± Trajet √âco: ${start} ‚Üí ${end}`;
                        break;
                }

                const response = await fetch(url);
                data = await response.json();

                // Afficher les r√©sultats selon le sc√©nario
                displayResults(scenario, data);

            } catch (error) {
                resultsContent.innerHTML = `
                    <div class="alert-box">
                        <strong>‚ùå Erreur:</strong> ${error.message}
                    </div>
                `;
            }
        }

        function displayResults(scenario, data) {
            const resultsContent = document.getElementById('resultsContent');
            let html = '';

            switch(scenario) {
                case 'city-dashboard':
                    html = `
                        <div class="result-section">
                            <h3>üìä √âtat Global</h3>
                            <span class="status-badge ${data.city_status.includes('‚úÖ') ? 'status-ok' : 'status-warning'}">
                                ${data.city_status}
                            </span>
                            ${data.alerts.length > 0 ? `
                                <div class="alert-box" style="margin-top: 10px;">
                                    ${data.alerts.map(alert => `<div>${alert}</div>`).join('')}
                                </div>
                            ` : ''}
                        </div>

                        <div class="result-section">
                            <h3>üöå Transport</h3>
                            <div class="metric-row">
                                <span class="metric-label">Status:</span>
                                <span class="metric-value">${data.transport.status}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Lignes op√©rationnelles:</span>
                                <span class="metric-value">${data.transport.operational}/${data.transport.total_lines}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Disponibilit√©:</span>
                                <span class="metric-value">${data.transport.availability}</span>
                            </div>
                        </div>

                        <div class="result-section">
                            <h3>üå¨Ô∏è Qualit√© de l'Air</h3>
                            <div class="metric-row">
                                <span class="metric-label">Status:</span>
                                <span class="metric-value">${data.air_quality.status}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">AQI Moyen:</span>
                                <span class="metric-value">${data.air_quality.average_aqi}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Zones surveill√©es:</span>
                                <span class="metric-value">${data.air_quality.zones_monitored}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Zones pollu√©es:</span>
                                <span class="metric-value">${data.air_quality.polluted_zones}</span>
                            </div>
                        </div>

                        <div class="result-section">
                            <h3>üèõÔ∏è Tourisme</h3>
                            <div class="metric-row">
                                <span class="metric-label">Status:</span>
                                <span class="metric-value">${data.tourism.status}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Attractions ouvertes:</span>
                                <span class="metric-value">${data.tourism.currently_open}/${data.tourism.total_attractions}</span>
                            </div>
                        </div>

                        <div class="result-section">
                            <h3>üö® Urgences</h3>
                            <div class="metric-row">
                                <span class="metric-label">Status:</span>
                                <span class="metric-value">${data.emergency.status}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">V√©hicules disponibles:</span>
                                <span class="metric-value">${data.emergency.available_vehicles}/${data.emergency.total_vehicles}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Interventions actives:</span>
                                <span class="metric-value">${data.emergency.active_interventions}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">En mission:</span>
                                <span class="metric-value">${data.emergency.on_mission}</span>
                            </div>
                        </div>
                    `;
                    break;

                case 'plan-trip':
                    html = `
                        <div class="result-section">
                            <h3>üå¨Ô∏è Qualit√© de l'Air</h3>
                            <div class="metric-row">
                                <span class="metric-label">AQI:</span>
                                <span class="metric-value">${data.air_quality.aqi} - ${data.air_quality.status}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Source:</span>
                                <span class="metric-value">${data.air_quality.source}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Temps r√©el:</span>
                                <span class="metric-value">${data.air_quality.real_time ? '‚úÖ Oui' : '‚ùå Non'}</span>
                            </div>
                        </div>

                        <div class="alert-box">
                            ${data.recommendation}
                        </div>

                        <div class="result-section">
                            <h3>üöå Transports Disponibles (${data.transports.length})</h3>
                            <ul class="transport-list">
                                ${data.transports.map(t => `
                                    <li class="transport-item">
                                        <strong>${t.mode}</strong> - ${t.route}
                                        <br><small style="color: #666;">Status: ${t.status}</small>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    `;
                    break;

                case 'emergency-response':
                    html = `
                        <div class="result-section">
                            <h3>üöë V√©hicule d'Urgence</h3>
                            ${data.emergency_vehicles.available ? `
                                <div class="metric-row">
                                    <span class="metric-label">V√©hicule:</span>
                                    <span class="metric-value">${data.emergency_vehicles.identifier}</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Type:</span>
                                    <span class="metric-value">${data.emergency_vehicles.type}</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">Station:</span>
                                    <span class="metric-value">${data.emergency_vehicles.station}</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">ETA:</span>
                                    <span class="metric-value">${data.emergency_vehicles.eta}</span>
                                </div>
                                <div class="metric-row">
                                    <span class="metric-label">√âquipe:</span>
                                    <span class="metric-value">${data.emergency_vehicles.crew_size} personnes</span>
                                </div>
                            ` : `
                                <div class="alert-box">
                                    ‚ö†Ô∏è ${data.emergency_vehicles.message}
                                </div>
                            `}
                        </div>

                        <div class="result-section">
                            <h3>üö¶ Impact Trafic</h3>
                            <div class="metric-row">
                                <span class="metric-label">Lignes affect√©es:</span>
                                <span class="metric-value">${data.traffic_impact.affected_lines}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Action:</span>
                                <span class="metric-value">${data.traffic_impact.action}</span>
                            </div>
                        </div>

                        <div class="result-section">
                            <h3>üìã Recommandations</h3>
                            <ul class="transport-list">
                                ${data.recommendations.map(rec => `
                                    <li class="transport-item">${rec}</li>
                                `).join('')}
                            </ul>
                        </div>
                    `;
                    break;

                case 'tourist-day':
                    html = `
                        <div class="result-section">
                            <h3>üå¨Ô∏è Conditions M√©t√©o</h3>
                            <div class="metric-row">
                                <span class="metric-label">AQI:</span>
                                <span class="metric-value">${data.air_quality.aqi} - ${data.air_quality.status}</span>
                            </div>
                            <div class="alert-box">
                                ${data.recommendation}
                            </div>
                        </div>

                        <div class="result-section">
                            <h3>üèõÔ∏è Attractions Recommand√©es (${data.attractions.length})</h3>
                            <ul class="transport-list">
                                ${data.attractions.map(attr => `
                                    <li class="transport-item">
                                        <strong>${attr.name}</strong>
                                        <br><small style="color: #666;">${attr.category} - Note: ${attr.rating}/5</small>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>

                        <div class="result-section">
                            <h3>üöå Transport Sugg√©r√©</h3>
                            <div class="transport-item">
                                <strong>${data.suggested_transport.mode || 'N/A'}</strong> - ${data.suggested_transport.route || 'N/A'}
                            </div>
                        </div>
                    `;
                    break;

                case 'eco-route':
                    html = `
                        <div class="result-section">
                            <h3>üå± Score √âcologique</h3>
                            <div style="text-align: center; font-size: 3em; color: #28a745;">
                                ${data.eco_score}/100
                            </div>
                        </div>

                        <div class="result-section">
                            <h3>üó∫Ô∏è Itin√©raire Recommand√©</h3>
                            <ul class="transport-list">
                                ${data.recommended_path.map(step => `
                                    <li class="transport-item">
                                        <strong>√âtape ${step.step}:</strong> ${step.zone}
                                        <br><small style="color: #666;">AQI: ${step.aqi}</small>
                                        ${step.action ? `<br><small style="color: #667eea;">‚ûú ${step.action}</small>` : ''}
                                    </li>
                                `).join('')}
                            </ul>
                        </div>

                        <div class="result-section">
                            <h3>üîÑ Alternatives</h3>
                            <ul class="transport-list">
                                ${data.alternatives.map(alt => `
                                    <li class="transport-item">
                                        <strong>${alt.name}</strong> (${alt.duration})
                                        <br><small style="color: #666;">Score: ${alt.eco_score}/100</small>
                                        <br><small style="color: #888;">${alt.note}</small>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    `;
                    break;
            }

            resultsContent.innerHTML = html;
        }
    </script>
</body>
</html>
