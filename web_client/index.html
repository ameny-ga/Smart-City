<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TuniLink - L'expÃ©rience urbaine rÃ©inventÃ©e</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
</head>
<body>
    <!-- Loader initial -->
    <div id="page-loader" class="page-loader">
        <div class="loader-content">
            <div class="spinner"></div>
            <p>Chargement de TuniLink...</p>
        </div>
    </div>

    <header>
        <div class="header-content">
            <div class="header-left">
                <h1>ğŸ”— TuniLink</h1>
                <p>L'expÃ©rience urbaine rÃ©inventÃ©e</p>
            </div>
            <div class="header-right">
                <div class="connection-status" id="connection-status">
                    <span class="status-dot"></span>
                    <span class="status-text">Connexion...</span>
                </div>
                <div class="current-time" id="current-time"></div>
                <button id="login-btn" onclick="showLoginModal()" class="btn-login">ğŸ” Connexion</button>
                <div id="user-info" class="user-info" style="display:none;">
                    <span id="user-name"></span>
                    <span id="user-role" class="user-role"></span>
                    <button onclick="logout()" class="btn-logout">DÃ©connexion</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Modal de connexion -->
    <div id="login-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <h2>ğŸ” Connexion</h2>
            <p>Connectez-vous pour accÃ©der aux fonctionnalitÃ©s d'administration</p>
            <input type="text" id="login-username" placeholder="Nom d'utilisateur" autocomplete="username">
            <input type="password" id="login-password" placeholder="Mot de passe" autocomplete="current-password" onkeypress="if(event.key==='Enter') login()">
            <div class="modal-actions">
                <button onclick="login()" class="btn-primary">Se connecter</button>
                <button onclick="hideLoginModal()" class="btn-secondary">Annuler</button>
            </div>
            <div class="login-help">
                <p><strong>Comptes de test :</strong></p>
                <p>ğŸ‘¨â€ğŸ’¼ Admin: <code>admin</code> / <code>admin123</code></p>
                <p>ğŸ‘¤ Utilisateur: <code>user</code> / <code>user123</code></p>
            </div>
        </div>
    </div>

    <nav>
        <div class="nav-container">
            <button class="nav-btn active" data-service="dashboard">
                <span class="nav-icon">ğŸ™ï¸</span>
                <span class="nav-label">Dashboard Ville</span>
            </button>
            <button class="nav-btn" data-service="trip-planner">
                <span class="nav-icon">ğŸ—ºï¸</span>
                <span class="nav-label">Planificateur</span>
            </button>
            <a href="orchestration.html" style="text-decoration: none;">
                <button class="nav-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <span class="nav-icon">ğŸ­</span>
                    <span class="nav-label">Orchestration</span>
                </button>
            </a>
            <button class="nav-btn" data-service="transport">
                <span class="nav-icon">ğŸšŒ</span>
                <span class="nav-label">Transport</span>
            </button>
            <button class="nav-btn" data-service="tourism">
                <span class="nav-icon">ğŸ›ï¸</span>
                <span class="nav-label">Tourisme</span>
            </button>
            <button class="nav-btn" data-service="air-quality">
                <span class="nav-icon">ğŸŒ«ï¸</span>
                <span class="nav-label">QualitÃ© Air</span>
            </button>
            <button class="nav-btn" data-service="emergency">
                <span class="nav-icon">ğŸš‘</span>
                <span class="nav-label">Urgences</span>
            </button>
        </div>
    </nav>

    <main>
        <!-- Dashboard Ville (Page d'accueil) -->
        <section id="dashboard" class="service-section active">
            <div class="section-header">
                <h2>ğŸ“ˆ Dashboard Ville en Temps RÃ©el</h2>
                <p class="description">Vue d'ensemble de tous les services de la Smart City</p>
            </div>
            
            <div class="city-stats-grid">
                <div class="stat-card transport-stat clickable" onclick="showServiceDetails('transport')" title="Cliquez pour voir les dÃ©tails">
                    <div class="stat-icon">ğŸšŒ</div>
                    <div class="stat-content">
                        <h3>Transport</h3>
                        <p class="stat-value" id="dash-transport-value">-</p>
                        <p class="stat-label" id="dash-transport-label">lignes opÃ©rationnelles</p>
                    </div>
                </div>
                <div class="stat-card air-stat clickable" onclick="showServiceDetails('air-quality')" title="Cliquez pour voir les dÃ©tails">
                    <div class="stat-icon">ğŸŒ«ï¸</div>
                    <div class="stat-content">
                        <h3>QualitÃ© Air</h3>
                        <p class="stat-value" id="dash-air-value">-</p>
                        <p class="stat-label" id="dash-air-label">AQI moyen</p>
                    </div>
                </div>
                <div class="stat-card tourism-stat clickable" onclick="showServiceDetails('tourism')" title="Cliquez pour voir les dÃ©tails">
                    <div class="stat-icon">ğŸ›ï¸</div>
                    <div class="stat-content">
                        <h3>Tourisme</h3>
                        <p class="stat-value" id="dash-tourism-value">-</p>
                        <p class="stat-label" id="dash-tourism-label">attractions ouvertes</p>
                    </div>
                </div>
                <div class="stat-card emergency-stat clickable" onclick="showServiceDetails('emergency')" title="Cliquez pour voir les dÃ©tails">
                    <div class="stat-icon">ğŸš‘</div>
                    <div class="stat-content">
                        <h3>Urgences</h3>
                        <p class="stat-value" id="dash-emergency-value">-</p>
                        <p class="stat-label" id="dash-emergency-label">vÃ©hicules disponibles</p>
                    </div>
                </div>
            </div>
            
            <div class="city-status-card" id="city-status-card">
                <h3>Ã‰tat de la ville</h3>
                <p class="city-status-text" id="city-status-text">Chargement...</p>
            </div>
            
            <div class="alerts-section" id="alerts-section" style="display:none;">
                <h3>âš ï¸ Alertes Actives</h3>
                <div id="alerts-list"></div>
            </div>
            
            <button onclick="loadCityDashboard()" class="btn-gradient">
                <span class="btn-icon">ğŸ”„</span>
                <span>Actualiser les donnÃ©es</span>
            </button>
        </section>

        <!-- Planificateur de Trajet (Orchestration) -->
        <section id="trip-planner" class="service-section">
            <div class="section-header">
                <h2>ğŸ—ºï¸ Planificateur de Trajet Intelligent</h2>
                <p class="description">Planifiez votre trajet en tenant compte de la qualitÃ© de l'air et des transports disponibles</p>
            </div>
            
            <div class="planner-form-modern">
                <div class="form-group">
                    <label for="zone-select">
                        <span class="label-icon">ğŸ“</span>
                        <span>Zone de destination</span>
                    </label>
                    <div class="select-wrapper">
                        <select id="zone-select">
                            <option value="">SÃ©lectionnez une zone...</option>
                            <option value="Tunis Centre-Ville">ğŸ›ï¸ Tunis Centre-Ville</option>
                            <option value="La Marsa">ğŸ–ï¸ La Marsa</option>
                            <option value="Carthage">ğŸº Carthage</option>
                            <option value="Sidi Bou SaÃ¯d">ğŸ¨ Sidi Bou SaÃ¯d</option>
                            <option value="Ariana">ğŸ¢ Ariana</option>
                            <option value="Bardo">ğŸ–¼ï¸ Bardo</option>
                            <option value="La Goulette">âš“ La Goulette</option>
                            <option value="AÃ©roport Tunis-Carthage">âœˆï¸ AÃ©roport Tunis-Carthage</option>
                        </select>
                    </div>
                </div>
                <button onclick="planTrip()" class="btn-gradient">
                    <span class="btn-icon">ğŸ”</span>
                    <span>Planifier mon trajet</span>
                </button>
            </div>

            <div id="trip-result" class="trip-result" style="display:none;">
                <!-- QualitÃ© de l'air -->
                <div class="air-quality-card">
                    <h3>ğŸŒ«ï¸ QualitÃ© de l'air</h3>
                    <div class="aqi-badge" id="aqi-badge">
                        <span class="aqi-value" id="aqi-value">-</span>
                        <span class="aqi-label">AQI</span>
                    </div>
                    <p id="air-status">-</p>
                </div>

                <!-- Recommandation -->
                <div class="recommendation-card">
                    <h3>ğŸ’¡ Recommandation</h3>
                    <p id="recommendation-text">-</p>
                </div>

                <!-- Transports disponibles -->
                <div class="transports-card">
                    <h3>ğŸšŒ Transports recommandÃ©s</h3>
                    <div id="recommended-transports" class="transport-list"></div>
                </div>
            </div>

            <div id="trip-loading" class="loading" style="display:none;">
                <p>â³ Analyse en cours...</p>
            </div>
        </section>

        <!-- Service Transport -->
        <section id="transport" class="service-section">
            <h2>ğŸšŒ Service Transport (REST)</h2>
            <div class="actions">
                <button onclick="loadTransports()" class="btn-primary">Charger les transports</button>
                <button onclick="showAddTransportForm()" class="btn-secondary">Ajouter un transport</button>
            </div>
            <div id="transport-content" class="content-area"></div>
            <div id="add-transport-form" class="form-container" style="display:none;">
                <h3>Nouveau Transport</h3>
                <input type="text" id="transport-mode" placeholder="Mode (Bus, MÃ©tro, Tramway)">
                <input type="text" id="transport-route" placeholder="Route (ex: Ligne 1)">
                <select id="transport-status">
                    <option value="operationnel">OpÃ©rationnel</option>
                    <option value="en_maintenance">En maintenance</option>
                    <option value="hors_service">Hors service</option>
                </select>
                <button onclick="createTransport()" class="btn-primary">CrÃ©er</button>
                <button onclick="hideAddTransportForm()" class="btn-secondary">Annuler</button>
            </div>
            <div id="edit-transport-form" class="form-container" style="display:none;">
                <h3>Modifier Transport</h3>
                <input type="hidden" id="edit-transport-id">
                <input type="text" id="edit-transport-mode" placeholder="Mode (Bus, MÃ©tro, Tramway)">
                <input type="text" id="edit-transport-route" placeholder="Route (ex: Ligne 1)">
                <select id="edit-transport-status">
                    <option value="operationnel">OpÃ©rationnel</option>
                    <option value="en_maintenance">En maintenance</option>
                    <option value="hors_service">Hors service</option>
                </select>
                <button onclick="updateTransport()" class="btn-primary">Sauvegarder</button>
                <button onclick="hideEditTransportForm()" class="btn-secondary">Annuler</button>
            </div>
        </section>

        <!-- Service Tourisme -->
        <section id="tourism" class="service-section">
            <h2>ğŸ›ï¸ Service Tourisme (GraphQL)</h2>
            <div class="actions">
                <button onclick="loadAttractions()" class="btn-primary">Charger les attractions</button>
            </div>
            <div id="tourism-content" class="content-area"></div>
        </section>

        <!-- Service QualitÃ© de l'Air -->
        <section id="air-quality" class="service-section">
            <div class="section-header">
                <h2>ğŸŒ«ï¸ QualitÃ© de l'Air (SOAP)</h2>
                <p class="description">Surveillance de la qualitÃ© de l'air en temps rÃ©el dans toutes les zones de la ville</p>
            </div>
            <div class="actions">
                <button onclick="loadAirQuality()" class="btn-primary">Actualiser les mesures</button>
            </div>
            <div id="air-quality-content" class="content-area"></div>
        </section>

        <!-- Service Urgences -->
        <section id="emergency" class="service-section">
            <div class="section-header">
                <h2>ğŸš‘ Service d'Urgence (gRPC)</h2>
                <p class="description">Gestion des vÃ©hicules d'urgence et interventions en cours</p>
            </div>
            <div class="actions">
                <button onclick="loadEmergencyData()" class="btn-primary">Actualiser les donnÃ©es</button>
            </div>
            <div id="emergency-content" class="content-area">
                <div class="emergency-grid">
                    <div class="emergency-section">
                        <h3>ğŸš— VÃ©hicules d'urgence</h3>
                        <div id="emergency-vehicles"></div>
                    </div>
                    <div class="emergency-section">
                        <h3>ğŸš¨ Interventions actives</h3>
                        <div id="emergency-interventions"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>Smart City Dashboard - Architecture Microservices avec API Gateway</p>
        <p>REST | SOAP | GraphQL | gRPC</p>
    </footer>

    <script src="auth.js"></script>
    <script src="app.js"></script>
</body>
</html>
